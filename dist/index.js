'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _request=require('request'),_request2=_interopRequireDefault(_request),_undefsafe=require('undefsafe'),_undefsafe2=_interopRequireDefault(_undefsafe);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var apiVersion='1',liveUrl='https://api.pin.net.au',testUrl='https://test-api.pin.net.au',MODE={POST:'post',GET:'get',PUT:'put',DELETE:'delete'},ENDPOINT={CUSTOMER:'customers',CHARGES:'charges',CARDS:'cards'},DELETE=204,PinAPI=function a(b){var c=this;_classCallCheck(this,a),this.setApiUrl=function(a){c.apiUrl=a?liveUrl:testUrl},this.formatResponse=function(){},this.handleAuthentication=function(a){a.auth(c.key,'')},this.handleErrorResponse=function(a,b){console.log(a),b(a)},this.handleSuccessResponse=function(a,b,c){var d=b;(0,_undefsafe2.default)(b,'response')&&(0,_undefsafe2.default)(b,'pagination')===void 0&&(d=b.response),a.statusCode===DELETE&&(d={success:!0}),c(d)},this.makeRequest=function(a){var b=a.token,d=a.body,e=a.endpoint,f=a.mode,g=a.debug,h=c.apiUrl+'/'+apiVersion+'/'+e.primary;return(0,_undefsafe2.default)(b,'primary')&&(h+='/'+b.primary),(0,_undefsafe2.default)(e,'secondary')&&(h+='/'+e.secondary),(0,_undefsafe2.default)(b,'secondary')&&(h+='/'+b.secondary),new Promise(function(a,b){var e=_request2.default[f]({url:h,json:!0,body:d},function(d,e,f){d?c.handleErrorResponse(d,b):g?a({url:h,body:f}):c.handleSuccessResponse(e,f,a)});c.handleAuthentication(e)})},this.createCustomer=function(a){return c.makeRequest({body:a,endpoint:{primary:ENDPOINT.CUSTOMER},mode:MODE.POST})},this.fetchAllCustomers=function(a){return c.makeRequest({body:a,endpoint:{primary:ENDPOINT.CUSTOMER},mode:MODE.GET})},this.fetchCustomer=function(a){return c.makeRequest({token:{primary:a},endpoint:{primary:ENDPOINT.CUSTOMER},mode:MODE.GET})},this.updateCustomer=function(a,b){return c.makeRequest({token:{primary:a},body:b,endpoint:{primary:ENDPOINT.CUSTOMER},mode:MODE.PUT})},this.deleteCustomer=function(a){return c.makeRequest({token:{primary:a},endpoint:{primary:ENDPOINT.CUSTOMER},mode:MODE.DELETE})},this.customerCharges=function(a){return c.makeRequest({token:{primary:a},endpoint:{primary:ENDPOINT.CUSTOMER,secondary:ENDPOINT.CHARGES},mode:MODE.GET})},this.customerCards=function(a){return c.makeRequest({token:{primary:a},endpoint:{primary:ENDPOINT.CUSTOMER,secondary:ENDPOINT.CARDS},mode:MODE.GET})},this.createCustomerCard=function(a,b){return c.makeRequest({body:a,token:{primary:b},endpoint:{primary:ENDPOINT.CUSTOMER,secondary:ENDPOINT.CARDS},mode:MODE.POST})},this.deleteCustomerCard=function(a,b){return c.makeRequest({token:{primary:a,secondary:b},endpoint:{primary:ENDPOINT.CUSTOMER,secondary:ENDPOINT.CARDS},mode:MODE.DELETE})},this.createCharge=function(a){return c.makeRequest({body:a,endpoint:{primary:ENDPOINT.CHARGES},mode:MODE.POST})},this.key=b.key,this.live=b.live,this.setApiUrl()};exports.default=PinAPI;
